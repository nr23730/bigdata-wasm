<!DOCTYPE html>
<html>
<head>
    <title>BigData WebAssembly</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="lib/require.js"></script>
</head>
<body>
<div id="inputs" style="float:left;">
<textarea id="code" style="width:250px;height:200px">
fun main(mul : Int) : Int {
   var a : Int
   a = 4
   var b : Int = 6
   var c : Boolean = true
   var d : Int = 0
   if(c != false) {
      d = a+b*mul
   } else {
      d = 0
   }
   return d
}

</textarea>
    <br/>
    <button id="parse">compile + execute</button>
    <br/>
    Note: The default value handed to the function is 10. So the expected result for the given example is 64.<br/>
    You can also use other values using the console built into your browser by calling "$ main(10)".
</div>
<div id="outputs" style="float:left">
    <div id="wat" style="float:left;margin-left:10px"></div>
    <div id="wasm" style="float:left;width:400px;margin-left:10px;"></div>
</div>
<div id="result" style="clear:both"></div>
<script type="text/javascript">
    var main;

    var antlr4 = require('antlr4/index');
    var BigDataLexer = require('parser/BigDataLexer');
    var BigDataParser = require('parser/BigDataParser');
    var MyListener = require('js/MyListener');
    document.getElementById("parse").addEventListener("click", function () {
        var input = document.getElementById("code").value;
        var chars = new antlr4.InputStream(input);
        var lexer = new BigDataLexer.BigDataLexer(chars);
        var tokens = new antlr4.CommonTokenStream(lexer);
        var parser = new BigDataParser.BigDataParser(tokens);
        parser.buildParseTrees = true;
        var tree = parser.input();
        var listener = new MyListener(parser);
        antlr4.tree.ParseTreeWalker.DEFAULT.walk(listener, tree);
        document.getElementById('wat').innerText = "WebAssembly-Text (WAT):\n\n" + listener.wat;
        wasm = listener.getWasm();
        console.log(wasm);
        document.getElementById('wasm').innerText = "WebAssembly-Bytecode (WASM):\n\n" + wasm;
        var wasmModule = new WebAssembly.Module(new Uint8Array(wasm));
        var wasmInstance = new WebAssembly.Instance(wasmModule);
        main = wasmInstance.exports.main;
        document.getElementById('result').innerText = "Output:\n\n" + main(10);
    });
</script>
</body>
</html>